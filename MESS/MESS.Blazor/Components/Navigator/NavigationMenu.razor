@using Microsoft.AspNetCore.Components.Authorization


<div>
    @*<!-- Toggle Button (optional, uncomment if you want to use) -->
    <button class="btn btn-outline-secondary m-2"
            @onclick="OnToggleClicked"
            style="z-index: 1051; position: relative;">
        ☰
    </button> *@

    <!-- Sidebar Panel -->
    <div class="sidebar-panel @(IsOpen ? "open" : "closed")" style="padding: 1rem;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn-close" @onclick="OnToggleClicked" />
        </div>

        <!-- Styled Navigation Buttons -->
        <div class="d-grid gap-2">
            
            <!-- Available to every user -->
            <AuthorizeView Roles="Operator, Technician, Administrator">
                <NavLink class="btn btn-sm btn-outline-secondary text-start"
                         href="/production-log" @onclick="OnToggleClicked">
                    My Production
                </NavLink>
                <NavLink class="btn btn-sm btn-outline-secondary text-start"
                         href="/production-logs" @onclick="OnToggleClicked">
                    My Production Logs
                </NavLink>
            </AuthorizeView>


            <!-- Available to Technicians & Admins -->
            <AuthorizeView Roles="Technician, Administrator">
                <NavLink class="btn btn-sm btn-outline-secondary text-start"
                         href="/WorkInstructionManager" @onclick="OnToggleClicked">
                    Instructions
                </NavLink>
                <NavLink class="btn btn-sm btn-outline-secondary text-start"
                         href="/users" @onclick="OnToggleClicked">
                    Users
                </NavLink>
                <NavLink class="btn btn-sm btn-outline-secondary text-start"
                         href="/products" @onclick="OnToggleClicked">
                    Products
                </NavLink>
            </AuthorizeView>


            <!-- Available to Admins -->
            <AuthorizeView Roles="Administrator">
                <NavLink class="btn btn-sm btn-outline-secondary text-start"
                         href="/log-archive" @onclick="OnToggleClicked">
                    Log Archive
                </NavLink>
            </AuthorizeView>
        </div>
    </div>
</div>

@code {
    /// <summary>
    /// Gets or sets a value indicating whether the sidebar is open or closed.
    /// </summary>
    [Parameter]
    public bool IsOpen { get; set; } = false;

    /// <summary>
    /// Event callback triggered when the sidebar toggle button or any navigation link is clicked.
    /// Used to notify parent components to toggle the sidebar visibility.
    /// </summary>
    [Parameter]
    public EventCallback OnToggle { get; set; }

    private async Task OnToggleClicked()
    {
        if (OnToggle.HasDelegate)
        {
            await OnToggle.InvokeAsync(null);
        }
    }
}
