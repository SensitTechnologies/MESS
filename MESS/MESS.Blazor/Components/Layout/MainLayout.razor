@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.FluentUI.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Routing
@inject ILogger<MainLayout> DemoLogger
@inject IJSRuntime JS
@inherits LayoutComponentBase

<HeadContent>
    <script src="darkmode.js"></script>
</HeadContent>

<!-- Top Bar with Menu -->
<div class="position-sticky top-0 d-flex align-items-center gap-3 px-3 py-2" style="z-index: 1040;">
    <!-- Toggle Menu Button -->
    <button class="btn btn-outline-secondary"
            @onclick="ToggleMenu"
            style="width: 32px; height: 32px; padding: 0; font-size: 1rem; display: flex; align-items: center; justify-content: center; border-radius: 0.25rem;">
        ☰
    </button>

    <div class="flex-grow-1"></div>

    @* <!-- Dark Mode Toggle Button -->
    <button class="btn btn-outline-secondary"
            @onclick="ToggleDarkMode"
            style="font-size: 1.2rem; padding: 0.25rem 0.5rem;">
        @(isDarkMode ? "\u2600\ufe0f" : "\ud83c\udf19")
    </button> *@
</div>

<!-- Sidebar -->
<div class="bg-light shadow-sm"
     style="
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 250px;
        padding: 1rem;
        overflow-y: auto;
        transform: @(isMenuOpen ? "translateX(0)" : "translateX(-100%)");
        transition: transform 0.3s ease-in-out;
        z-index: 1050;
    ">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <button class="btn-close" @onclick="ToggleMenu" aria-label="Close sidebar" />
    </div>

    <!-- Navigation Links -->
    <div class="d-grid gap-2">
        <NavLink class="btn btn-sm btn-outline-secondary text-start"
                 href="/production-log" @onclick="ToggleMenu" Match="NavLinkMatch.All">
            Production
        </NavLink>
        <NavLink class="btn btn-sm btn-outline-secondary text-start"
                 href="/WorkInstructionManager" @onclick="ToggleMenu">
            Instructions
        </NavLink>
        <NavLink class="btn btn-sm btn-outline-secondary text-start"
                 href="/users" @onclick="ToggleMenu">
            Users
        </NavLink>
        <NavLink class="btn btn-sm btn-outline-secondary text-start"
                 href="/products" @onclick="ToggleMenu">
            Products
        </NavLink>
    </div>
</div>

<!-- Main Content -->
<main style="margin-left: @(isMenuOpen ? "250px" : "0"); transition: margin-left 0.3s ease;">
    <article class="content px-4 mx-auto">
        @Body
    </article>
</main>

<!-- Error UI -->
<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>

<!-- Fluent Providers -->
<FluentToastProvider />
<FluentDialogProvider />
<FluentTooltipProvider />
<FluentMessageBarProvider />
<FluentMenuProvider />

@code {
    private bool isMenuOpen = false;
    // private bool isDarkMode = false;

    private void ToggleMenu()
    {
        isMenuOpen = !isMenuOpen;
    }

    // private async Task ToggleDarkMode()
    // {
    //     isDarkMode = !isDarkMode;
    //     await JS.InvokeVoidAsync("toggleDarkMode", isDarkMode);
    // }
}
